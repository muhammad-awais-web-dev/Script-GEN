<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cinematic Horror Story Generator - Standalone</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto Mono', monospace;
            background-color: #111827;
            color: #d1d5db;
            line-height: 1.6;
        }

        .container {
            max-width: 64rem;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid rgba(20, 184, 166, 0.3);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(to right, #2dd4bf, #22d3ee);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
        }

        .subtitle {
            color: #9ca3af;
            max-width: 48rem;
            margin: 0 auto;
        }

        .main-content {
            text-align: center;
        }

        .generate-btn {
            background-color: #14b8a6;
            color: #111827;
            font-weight: bold;
            padding: 0.75rem 2rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            box-shadow: 0 10px 15px -3px rgba(20, 184, 166, 0.2);
            transition: all 0.3s ease;
            font-family: 'Roboto Mono', monospace;
        }

        .generate-btn:hover:not(:disabled) {
            background-color: #0d9488;
            transform: scale(1.05);
        }

        .generate-btn:disabled {
            background-color: #4b5563;
            cursor: not-allowed;
            box-shadow: none;
        }

        .loading-container {
            margin-top: 2rem;
        }

        .spinner {
            border: 4px solid transparent;
            border-top: 4px solid #14b8a6;
            border-right: 4px solid #14b8a6;
            border-radius: 50%;
            width: 64px;
            height: 64px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 1rem;
            font-size: 1.125rem;
            color: #5eead4;
        }

        .loading-subtext {
            margin-top: 0.5rem;
            font-size: 0.875rem;
            color: #6b7280;
        }

        .error-box {
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: rgba(127, 29, 29, 0.5);
            border: 1px solid #991b1b;
            color: #fca5a5;
            border-radius: 0.5rem;
        }

        .story-container {
            margin-top: 2.5rem;
            text-align: left;
            background-color: rgba(17, 24, 39, 0.5);
            padding: 2rem;
            border-radius: 0.5rem;
            border: 2px solid rgba(20, 184, 166, 0.3);
        }

        .story-title {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #374151;
        }

        .section {
            margin-bottom: 1.5rem;
            background-color: rgba(31, 41, 55, 0.5);
            border: 1px solid #374151;
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .section-header {
            width: 100%;
            padding: 1rem;
            background-color: #1f2937;
            border: none;
            color: #5eead4;
            font-weight: bold;
            font-size: 1.25rem;
            text-align: left;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'Roboto Mono', monospace;
            transition: background-color 0.2s;
        }

        .section-header:hover {
            background-color: rgba(55, 65, 81, 0.5);
        }

        .section-number {
            color: #6b7280;
            margin-right: 0.5rem;
        }

        .section-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .download-btn {
            padding: 0.5rem;
            background: transparent;
            border: none;
            color: #5eead4;
            cursor: pointer;
            border-radius: 50%;
            transition: background-color 0.2s;
        }

        .download-btn:hover {
            background-color: #4b5563;
        }

        .section-arrow {
            color: #5eead4;
            transition: transform 0.3s;
            font-size: 1.5rem;
            line-height: 1;
        }

        .section-arrow.open {
            transform: rotate(90deg);
        }

        .section-content {
            padding: 1.5rem;
            border-top: 1px solid #374151;
            display: none;
        }

        .section-content.open {
            display: block;
        }

        .section-subtitle {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: #22d3ee;
        }

        .narration-line {
            margin-bottom: 1rem;
        }

        .scene-item {
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(55, 65, 81, 0.5);
        }

        .scene-item:last-child {
            border-bottom: none;
        }

        .scene-title {
            font-weight: bold;
            color: #22d3ee;
        }

        .scene-description {
            color: #9ca3af;
        }

        .lens-info {
            color: #5eead4;
            font-weight: 600;
        }

        .prompt-box {
            margin-bottom: 1rem;
            font-family: 'Roboto Mono', monospace;
            font-size: 0.875rem;
            background-color: rgba(0, 0, 0, 0.3);
            padding: 0.75rem;
            border-radius: 0.25rem;
        }

        .prompt-label {
            font-weight: bold;
            color: #22d3ee;
        }

        .prompt-text {
            color: #d1d5db;
            margin: 0.25rem 0;
        }

        .param-text {
            color: #5eead4;
        }

        ul {
            list-style-position: inside;
            color: #9ca3af;
        }

        li {
            margin-bottom: 0.5rem;
        }

        ol {
            list-style-position: inside;
            padding-left: 1rem;
            color: #9ca3af;
        }

        .disclaimer {
            font-size: 0.875rem;
            color: #6b7280;
            font-style: italic;
        }

        .copy-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            background-color: #0891b2;
            color: #e5e7eb;
            border: none;
            cursor: pointer;
            font-family: 'Roboto Mono', monospace;
            transition: background-color 0.2s;
        }

        .copy-btn:hover {
            background-color: #0e7490;
        }

        .hashtags {
            color: #67e8f9;
            word-wrap: break-word;
        }

        footer {
            text-align: center;
            margin-top: 3rem;
            color: #4b5563;
            font-size: 0.875rem;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.875rem;
            }
            
            .container {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>🎬 Cinematic Horror Story Generator</h1>
            <p class="subtitle">Produce a studio-ready deliverable for your next TikTok horror story.</p>
        </header>

        <div class="main-content">
            <button id="generateBtn" class="generate-btn">Generate Story Script</button>
            
            <div id="loadingContainer" class="loading-container" style="display: none;">
                <div class="spinner"></div>
                <p class="loading-text">Generating Cinematic Script...</p>
                <p class="loading-subtext">This may take a moment.</p>
            </div>

            <div id="errorContainer" style="display: none;"></div>
        </div>

        <div id="storyContainer" style="display: none;"></div>

        <footer>
            <p>Powered by Google Gemini. Designed for cinematic professionals.</p>
        </footer>
    </div>

    <script>
        // ========== CONFIGURATION ==========
        // IMPORTANT: Replace 'YOUR_API_KEY_HERE' with your actual Gemini API key
        const HARDCODED_API_KEY = 'YOUR_API_KEY_HERE';
        
        // ========== CONSTANTS ==========
        const SETTINGS = [
            "a remote desert weigh-station",
            "an eerie, underfunded hospital basement",
            "a sprawling, automated warehouse on the outskirts of town",
            "a forgotten subway maintenance tunnel",
            "a high-voltage power substation in a desolate area",
            "a clinical, sterile research lab after hours",
            "a run-down motel on a lonely highway",
            "a small town's empty library at midnight"
        ];

        const ROLES_MAP = {
            "a remote desert weigh-station": { role: "night-shift weigh station operator", jobTitle: "Operator", wardrobe: "a worn field jacket over a uniform shirt" },
            "an eerie, underfunded hospital basement": { role: "late-night morgue attendant", jobTitle: "Attendant", wardrobe: "standard-issue medical scrubs" },
            "a sprawling, automated warehouse on the outskirts of town": { role: "lone overnight inventory technician", jobTitle: "Technician", wardrobe: "a high-visibility safety vest over a work uniform" },
            "a forgotten subway maintenance tunnel": { role: "solitary track maintenance worker", jobTitle: "Worker", wardrobe: "heavy-duty coveralls and a hard hat" },
            "a high-voltage power substation in a desolate area": { role: "night-shift substation technician", jobTitle: "Technician", wardrobe: "a flame-retardant utility uniform" },
            "a clinical, sterile research lab after hours": { role: "junior lab assistant on cleanup duty", jobTitle: "Assistant", wardrobe: "a pristine white lab coat" },
            "a run-down motel on a lonely highway": { role: "night manager of a secluded motel", jobTitle: "Manager", wardrobe: "a slightly frayed blazer over a collared shirt" },
            "a small town's empty library at midnight": { role: "overnight security guard at the municipal archive", jobTitle: "Guard", wardrobe: "a crisp security guard uniform" }
        };

        const LENS_PATTERN = [
            { lens: '24mm', shotSize: 'wide' },
            { lens: '35mm', shotSize: 'medium' },
            { lens: '85mm', shotSize: 'close-up' },
            { lens: '100mm_macro', shotSize: 'macro' }
        ];

        const NEGATIVE_PROMPTS = "cartoon, overexposed, saturated colors, text overlay, harsh shadows, flat lighting, fantasy armor, anime lines, smiling faces, cluttered background, out-of-frame composition, low-res, motion blur, double exposure, watermark, logo, text artifacts, mutated hands, extra fingers, deformed limbs, duplicate face.";

        // ========== UTILITY FUNCTIONS ==========
        const getRandomElement = (arr) => arr[Math.floor(Math.random() * arr.length)];

        // ========== API FUNCTIONS ==========
        async function generateHorrorStory() {
            if (!HARDCODED_API_KEY || HARDCODED_API_KEY === 'YOUR_API_KEY_HERE') {
                throw new Error('Please set your Gemini API key in the HARDCODED_API_KEY variable at the top of this HTML file.');
            }

            const setting = getRandomElement(SETTINGS);
            const { role, jobTitle, wardrobe } = ROLES_MAP[setting];
            const randomId = Math.floor(Math.random() * 99) + 1;
            const characterIdentifier = `${jobTitle} #${randomId}`;

            const prompt = `You are an elite cinematic scriptwriter specializing in psychological horror for TikTok, creating a "rule-based" scenario.
Generate a complete studio-ready script and production plan based on the following parameters:
- Setting: ${setting}
- Role: ${role}
- Character: Southeast Asian male, early 40s, short black hair, gaunt, tired eyes, moody silhouette.

Your output MUST be a valid JSON object. Do not include any markdown formatting like \`\`\`json.

The JSON object must conform to this schema:
{
  "title": "A short, ominous, cinematic title.",
  "rules": ["An array of exactly 8 short, imperative rules. Do NOT include prefixes like 'Rule 1:'. Just provide the rule text. The rules should escalate from mild unease to hopelessness. Each rule is a string."],
  "scene_concepts": ["An array of exactly 24 brief, evocative scene concepts, 3 for each of the 8 rules. These should describe an action or a visual related to the corresponding rule."],
  "viral_titles": ["An array of 10 short, ominous, headline-style titles for social media."],
  "viral_hook": "A 1-2 sentence hook for the first 5 seconds of the video, based on the story.",
  "hashtags": ["An array of 10 relevant hashtags."]
}

Follow these constraints for the content:
- The total narration (the 8 rules) must be 120-165 words.
- The tone must be eerie, cinematic, and psychological, not gory.`;

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${HARDCODED_API_KEY}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: prompt
                        }]
                    }],
                    generationConfig: {
                        temperature: 1.0,
                        responseMimeType: 'application/json',
                        responseSchema: {
                            type: 'OBJECT',
                            properties: {
                                title: { type: 'STRING' },
                                rules: {
                                    type: 'ARRAY',
                                    items: { type: 'STRING' }
                                },
                                scene_concepts: {
                                    type: 'ARRAY',
                                    items: { type: 'STRING' }
                                },
                                viral_titles: {
                                    type: 'ARRAY',
                                    items: { type: 'STRING' }
                                },
                                viral_hook: { type: 'STRING' },
                                hashtags: {
                                    type: 'ARRAY',
                                    items: { type: 'STRING' }
                                }
                            },
                            required: ["title", "rules", "scene_concepts", "viral_titles", "viral_hook", "hashtags"]
                        }
                    }
                })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`API Error: ${errorData.error?.message || response.statusText}`);
            }

            const result = await response.json();
            const rawJson = result.candidates[0].content.parts[0].text.trim();
            const generatedContent = JSON.parse(rawJson);

            // Build the final story data
            const formattedRules = generatedContent.rules.map((rule, index) => `Rule No ${index + 1}: ${rule}`);

            const importantRuleIndex = Math.floor(Math.random() * 3) + 5;
            const importantRuleNumber = importantRuleIndex + 1;
            const attentionGrabbingLine = `Rule No ${importantRuleNumber} is the most important to follow. Pay close attention.`;

            const narrationScript = [
                `Congratulations. You've been hired as ${role} at ${setting}.`,
                attentionGrabbingLine,
                ...formattedRules,
                `Stay calm. Follow the rules. Good luck, ${jobTitle}.`
            ];

            const scenes = [];
            scenes.push({ 
                title: 'Elevator Arrival', 
                description: `teal overhead neon flicker, dense fog, ${characterIdentifier}'s silhouette entering the main door of the ${setting}, soft tungsten desk lamp pool, shallow DOF, cinematic realism.`, 
                ...LENS_PATTERN[0] 
            });
            scenes.push({ 
                title: 'ID Badge Scan', 
                description: `${characterIdentifier} scans ID badge #${randomId} at a security panel. A green light briefly illuminates his tired face.`, 
                ...LENS_PATTERN[1] 
            });
            scenes.push({ 
                title: 'The Empty Workspace', 
                description: 'A slow pan across the eerily quiet and empty workspace. A single monitor hums, casting a cyan glow.', 
                ...LENS_PATTERN[2] 
            });

            generatedContent.scene_concepts.forEach((concept, index) => {
                const pattern = LENS_PATTERN[(index + 3) % LENS_PATTERN.length];
                scenes.push({
                    title: `Rule ${Math.floor(index / 3) + 1} - Scene ${index % 3 + 1}`,
                    description: concept,
                    ...pattern
                });
            });

            scenes.push({ 
                title: 'A Rule Broken', 
                description: 'A piece of equipment malfunctions violently, its warning light flashing a desperate red against the dominant teal.', 
                ...LENS_PATTERN[0] 
            });
            scenes.push({ 
                title: 'Resigned Fear', 
                description: `Close up on ${characterIdentifier}'s face, eyes wide, reflecting the chaos. He is frozen, realizing his mistake.`, 
                ...LENS_PATTERN[1] 
            });
            scenes.push({ 
                title: 'Final Glance', 
                description: `Macro shot of the ID badge #${randomId}, slightly askew on his uniform. The name is out of focus, only the number is clear.`, 
                ...LENS_PATTERN[2] 
            });

            const veoPrompts = scenes.map((scene, index) => {
                const prompt = `${scene.description}, cinematic anime style, teal-cyan neon lighting, tungsten accents, volumetric fog, shallow DOF, cinematic realism, film grain, chromatic aberration, scanlines, desaturated tones, soft vignette, moody atmosphere. Primary: Southeast Asian male, early 40s, short black hair, gaunt, ID#${randomId}, ${wardrobe}, consistent with ${setting}.`;
                const parameters = `--ar 9:16 --style cinematic --lighting teal_neon --camera ${scene.lens} --grain film --depth shallow --vibe eerie --quality ultra --saturation -15 --contrast +10 --fog moderate --vfx_scanlines subtle`;
                return { prompt, parameters };
            });

            const thumbnailPrompt = `${setting} in teal-cyan neon haze, cinematic anime style, warm tungsten pool, ${jobTitle}'s silhouette (male, early 40s, short black hair, ID#${randomId}) half-turned toward camera, monitor glow reflected in eyes, film grain, scanlines, chromatic aberration, shallow DOF, cinematic vignette.`;

            return {
                title: generatedContent.title,
                setting,
                role,
                jobTitle,
                wardrobe,
                narrationScript,
                scenes,
                veoPrompts,
                musicAndSfxNotes: [
                    "Ambient Base: A low, continuous mechanical hum or lab drone in the key of C#.",
                    "Transitional Cues: Sudden metallic creaks, a sharp hiss of steam, or faint, distant knocking between rule segments.",
                    "Emotional Cues: A subtle, deep bass pulse that slowly rises in intensity and frequency with each rule, peaking at rule 8.",
                    "Pacing Bed (Optional): An 85 BPM dark ambient track with a simple, repeating synth line to drive the 60-second flow for TikTok.",
                    "Mixing Note: Ensure the Voiceover remains clear and intelligible. Sidechain the pacing bed by -4 dB whenever the narrator speaks."
                ],
                voiceoverDirection: [
                    "Tone: Deliver the lines in a calm, detached, almost clinical manner. The voice should feel inhumanly professional.",
                    "Pacing: Speak at approximately 70% of a normal pace, leaving deliberate, unnerving pauses between phrases.",
                    "Breath Beats: Treat each numbered rule as a separate thought. Take a small, audible breath (100-200 ms) before starting each new rule.",
                    "Final Line: The final line, 'Good luck...', should be delivered as a soft, almost inaudible whisper, mixed -6 dB below the main VO level."
                ],
                viralTitles: generatedContent.viral_titles,
                viralHook: generatedContent.viral_hook,
                thumbnailPrompt,
                hashtags: generatedContent.hashtags
            };
        }

        // ========== UI FUNCTIONS ==========
        function downloadTextAsFile(content, filename) {
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function createSection(title, sectionNumber, icon, content, downloadData) {
            const sectionId = `section-${sectionNumber}`;
            const section = document.createElement('div');
            section.className = 'section';
            
            const header = document.createElement('button');
            header.className = 'section-header';
            header.innerHTML = `
                <span>
                    <span class="section-number">${String(sectionNumber).padStart(2, '0')}</span>
                    ${icon} ${title}
                </span>
                <div class="section-actions">
                    ${downloadData ? '<button class="download-btn">⬇️</button>' : ''}
                    <span class="section-arrow open">▸</span>
                </div>
            `;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'section-content open';
            contentDiv.innerHTML = content;
            
            header.addEventListener('click', () => {
                const arrow = header.querySelector('.section-arrow');
                if (contentDiv.classList.contains('open')) {
                    contentDiv.classList.remove('open');
                    arrow.classList.remove('open');
                } else {
                    contentDiv.classList.add('open');
                    arrow.classList.add('open');
                }
            });
            
            if (downloadData) {
                const downloadBtn = header.querySelector('.download-btn');
                downloadBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    downloadTextAsFile(downloadData.content, downloadData.filename);
                });
            }
            
            section.appendChild(header);
            section.appendChild(contentDiv);
            
            return section;
        }

        function renderStory(data) {
            const container = document.getElementById('storyContainer');
            container.innerHTML = '';
            container.style.display = 'block';
            
            container.className = 'story-container';
            container.innerHTML = `<h1 class="story-title">🎬 Rule-Based Horror Story – ${data.title}</h1>`;
            
            // Section 1: Narration Script
            const narrationContent = `
                <h3 class="section-subtitle">🎙 NARRATION SCRIPT</h3>
                <div>${data.narrationScript.map(line => `<p class="narration-line">${line}</p>`).join('')}</div>
            `;
            container.appendChild(createSection(
                'Story Script (Narration Format)',
                1,
                '🧩',
                narrationContent,
                { content: data.narrationScript.join('\n\n'), filename: '01_Narration_Script.txt' }
            ));
            
            // Section 2: Scenes
            const scenesContent = data.scenes.map((scene, i) => `
                <div class="scene-item">
                    <h4 class="scene-title">Scene ${String(i + 1).padStart(2, '0')} — ${scene.title}</h4>
                    <p class="scene-description">Description: ${scene.description} <span class="lens-info">[${scene.lens}]</span></p>
                </div>
            `).join('');
            container.appendChild(createSection(
                'Scene-by-Scene B-Roll Plan',
                2,
                '🧩',
                scenesContent,
                { 
                    content: data.scenes.map((s, i) => `Scene ${String(i + 1).padStart(2, '0')} — ${s.title}\nDescription: ${s.description} [${s.lens}]`).join('\n\n'),
                    filename: '02_B-Roll_Plan.txt'
                }
            ));
            
            // Section 3: Veo Prompts
            const veoContent = data.veoPrompts.map((p, i) => `
                <div class="prompt-box">
                    <p class="prompt-label">Prompt ${i + 1}:</p>
                    <p class="prompt-text">${p.prompt}</p>
                    <p class="prompt-label" style="margin-top: 0.5rem;">Parameters:</p>
                    <p class="param-text">${p.parameters}</p>
                </div>
            `).join('');
            container.appendChild(createSection(
                'Veo 3 Image Prompts (Optimized)',
                3,
                '🧩',
                veoContent,
                {
                    content: data.veoPrompts.map((p, i) => `Prompt ${i + 1}:\n${p.prompt}\n\nParameters:\n${p.parameters}\n\nNegative Prompts:\n${NEGATIVE_PROMPTS}`).join('\n\n---\n\n'),
                    filename: '03_Veo_Prompts.txt'
                }
            ));
            
            // Section 4: Music & SFX
            const musicContent = `<ul>${data.musicAndSfxNotes.map(note => `<li>${note}</li>`).join('')}</ul>`;
            container.appendChild(createSection(
                'Music + SFX Design Notes',
                4,
                '🧩',
                musicContent,
                { content: data.musicAndSfxNotes.join('\n'), filename: '04_Music_SFX_Notes.txt' }
            ));
            
            // Section 5: Voiceover Direction
            const voContent = `<ul>${data.voiceoverDirection.map(note => `<li>${note}</li>`).join('')}</ul>`;
            container.appendChild(createSection(
                'Voiceover Direction',
                5,
                '🧩',
                voContent,
                { content: data.voiceoverDirection.join('\n'), filename: '05_Voiceover_Direction.txt' }
            ));
            
            // Section 6: Viral Titles
            const viralContent = `
                <h4 class="section-subtitle">10 Title Options:</h4>
                <ol>${data.viralTitles.map(title => `<li>${title}</li>`).join('')}</ol>
                <h4 class="section-subtitle" style="margin-top: 1rem;">Hook Rewrite (First 5 seconds):</h4>
                <p style="color: #9ca3af; font-style: italic; margin-top: 0.5rem;">"${data.viralHook}"</p>
            `;
            container.appendChild(createSection(
                'Viral Title + Hook Options',
                6,
                '🧩',
                viralContent,
                {
                    content: `10 Title Options:\n${data.viralTitles.join('\n')}\n\nHook Rewrite (First 5 seconds):\n"${data.viralHook}"`,
                    filename: '06_Viral_Content.txt'
                }
            ));
            
            // Section 7: Thumbnail
            const thumbnailContent = `
                <div class="prompt-box">
                    <p class="prompt-label">Thumbnail Prompt:</p>
                    <p class="prompt-text">${data.thumbnailPrompt}</p>
                </div>
            `;
            container.appendChild(createSection(
                'Thumbnail Prompt',
                7,
                '🧩',
                thumbnailContent,
                { content: data.thumbnailPrompt, filename: '07_Thumbnail_Prompt.txt' }
            ));
            
            // Section 8: Safety Disclaimer
            const disclaimerContent = '<p class="disclaimer">This story and all visual elements are fictional. No real locations, persons, or organizations are depicted. All AI generations follow content safety standards.</p>';
            container.appendChild(createSection('Safety Disclaimer', 8, '🧩', disclaimerContent));
            
            // Section 9: Export Controls
            const exportContent = `
                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                    <button class="copy-btn" id="copyToClipboardBtn">
                        <span id="copyIcon">📋</span>
                        <span id="copyText">Copy to Clipboard</span>
                    </button>
                </div>
            `;
            container.appendChild(createSection('Export Controls', 9, '🧩', exportContent));
            
            // Add event listener for copy button
            const copyBtn = document.getElementById('copyToClipboardBtn');
            if (copyBtn) {
                copyBtn.addEventListener('click', () => {
                    if (!window.currentStoryData) return;
                    
                    const text = formatStoryForClipboard(window.currentStoryData);
                    navigator.clipboard.writeText(text).then(() => {
                        const icon = document.getElementById('copyIcon');
                        const textEl = document.getElementById('copyText');
                        icon.textContent = '✅';
                        textEl.textContent = 'Copied!';
                        setTimeout(() => {
                            icon.textContent = '📋';
                            textEl.textContent = 'Copy to Clipboard';
                        }, 2000);
                    });
                });
            }
            
            // Section 10: Hashtags
            const hashtagsContent = `<p class="hashtags">${data.hashtags.map(h => `#${h}`).join(' ')}</p>`;
            container.appendChild(createSection(
                'Viral Hashtags',
                10,
                '🧩',
                hashtagsContent,
                { content: data.hashtags.map(h => `#${h}`).join(' '), filename: '10_Viral_Hashtags.txt' }
            ));
            
            // Store data for clipboard copy
            window.currentStoryData = data;
        }

        function formatStoryForClipboard(data) {
            let text = `🎬 Rule-Based Horror Story – ${data.title}\n\n`;
            text += `🧩 SECTION 1: Story Script (Narration Format)\n🎙 NARRATION SCRIPT\n${data.narrationScript.join('\n\n')}\n\n`;
            text += `🎞 SECTION 2: Scene-by-Scene B-Roll Plan\n${data.scenes.map((s, i) => `Scene ${String(i + 1).padStart(2, '0')} — ${s.title}\nDescription: ${s.description} [${s.lens}]`).join('\n\n')}\n\n`;
            text += `🖼 SECTION 3: Veo 3 Image Prompts (Optimized)\n${data.veoPrompts.map((p, i) => `Prompt ${i + 1}:\n${p.prompt}\nParameters:\n${p.parameters}`).join('\n\n')}\n\n`;
            text += `🎵 SECTION 4: Music + SFX Design Notes\n${data.musicAndSfxNotes.join('\n')}\n\n`;
            text += `🔊 SECTION 5: Voiceover Direction\n${data.voiceoverDirection.join('\n')}\n\n`;
            text += `🧠 SECTION 6: Viral Title + Hook Options\nTitles:\n${data.viralTitles.join('\n')}\n\nHook Rewrite:\n${data.viralHook}\n\n`;
            text += `🧩 SECTION 7: Thumbnail Prompt\n${data.thumbnailPrompt}\n\n`;
            text += `⚠️ SECTION 8: Safety Disclaimer\nThis story and all visual elements are fictional. No real locations, persons, or organizations are depicted. All AI generations follow content safety standards.\n\n`;
            text += `SECTION 10: Viral Hashtags\n${data.hashtags.map(h => `#${h}`).join(' ')}\n`;
            return text;
        }

        // Main event handler
        document.getElementById('generateBtn').addEventListener('click', async () => {
            const btn = document.getElementById('generateBtn');
            const loadingContainer = document.getElementById('loadingContainer');
            const errorContainer = document.getElementById('errorContainer');
            const storyContainer = document.getElementById('storyContainer');
            
            btn.disabled = true;
            loadingContainer.style.display = 'block';
            errorContainer.style.display = 'none';
            storyContainer.style.display = 'none';
            
            try {
                const story = await generateHorrorStory();
                renderStory(story);
                setTimeout(() => {
                    storyContainer.scrollIntoView({ behavior: 'smooth' });
                }, 100);
            } catch (err) {
                errorContainer.className = 'error-box';
                errorContainer.textContent = err.message;
                errorContainer.style.display = 'block';
                console.error(err);
            } finally {
                btn.disabled = false;
                loadingContainer.style.display = 'none';
            }
        });
    </script>
</body>
</html>
